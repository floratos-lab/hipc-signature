<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:batch="http://www.springframework.org/schema/batch"
		xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-2.1.xsd
							http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
							http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <batch:job id="observationDataImporterJob">
        <!--
        <batch:step id="literatureFurman2013Step" parent="observationDataStep" next="literatureXXXXStep">
            <batch:tasklet>
                <batch:chunk reader="literatureFurman2013Reader" processor="observationDataProcessor" writer="observationDataWriter"/>
            </batch:tasklet>
        </batch:step>
        -->
        <batch:step id="literatureFurman2013Step" parent="observationDataStep">
            <batch:tasklet>
                <batch:chunk reader="literatureFurman2013Reader" processor="observationDataProcessor" writer="observationDataWriter"/>
            </batch:tasklet>
        </batch:step>
    </batch:job>

    <bean id="observationDataStep" class="org.springframework.batch.core.step.item.SimpleStepFactoryBean" abstract="true">
        <property name="transactionManager" ref="transactionManager" />
        <property name="jobRepository" ref="jobRepository" />
        <property name="commitInterval" value="${spring.batch.commit.interval}" />
    </bean>

    <bean name="literatureFurman2013LineMapper" class="org.springframework.batch.item.file.mapping.DefaultLineMapper">
        <property name="fieldSetMapper" ref="observationDataMapper" />
        <property name="lineTokenizer" ref="literatureFurman2013LineTokenizer" />
    </bean>
    <bean name="literatureFurman2013LineTokenizer" class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer" >
        <property name="delimiter" value="\u0009"/>
        <property name="names" value="dummy,submission_name,submission_date,template_name,gating_type_1,cell_marker_1,cell_marker_1_status,response_agent,time_point,time_point_units,baseline_time,experiment_type,number_subjects,age_group,infectious_agent,exposure_process,exposure_material,adjuvant,dose,route,scheduling,exposure_material_id,treatment,comparison,expected_behavior,publication_reference,publication_year,publication_reference_url"/>
    </bean>

    <!-- shared helper beans -->
    <bean name="observationTemplateMap" class="java.util.HashMap">
        <constructor-arg index="0" type="java.util.Map">
            <map key-type="java.lang.String" value-type="java.lang.String">

                <entry key="literature_furman_2013:gating_type_1" value="subject:findTissueSampleByName" />
                <entry key="literature_furman_2013:cell_marker_1" value="subject:findGenesBySymbol" />
                <entry key="literature_furman_2013:cell_marker_1_status" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:response_agent" value="subject:findGenesBySymbol" />
                <entry key="literature_furman_2013:time_point" value="evidence:readInt:createObservedNumericEvidence" />
                <entry key="literature_furman_2013:time_point_units" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:baseline_time" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:experiment_type" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:number_subjects" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:age_group" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:infectious_agent" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:exposure_process" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:exposure_material" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:adjuvant" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:dose" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:route" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:scheduling" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:exposure_material_id" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:treatment" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:comparison" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:expected_behavior" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:publication_reference" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:publication_year" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="literature_furman_2013:publication_reference_url" value="evidence:readString:createObservedUrlEvidence" />
            </map>
        </constructor-arg>
    </bean>
</beans>
