<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:batch="http://www.springframework.org/schema/batch"
		xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/batch http://www.springframework.org/schema/batch/spring-batch-3.0.xsd
							http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.1.xsd
							http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.2.xsd">

    <batch:job id="observationDataImporterJob">
        <batch:step id="litGeneExpressionStep" parent="observationDataStep" >
            <batch:tasklet>
                <batch:chunk reader="litGeneExpressionReader" processor="observationDataProcessor" writer="observationDataWriter"/>
            </batch:tasklet>
        </batch:step>
    </batch:job>

    <bean id="observationDataStep" class="org.springframework.batch.core.step.item.SimpleStepFactoryBean" abstract="true">
        <property name="transactionManager" ref="transactionManager" />
        <property name="jobRepository" ref="jobRepository" />
        <property name="commitInterval" value="${spring.batch.commit.interval}" />
    </bean>

    <bean name="litGeneExpressionLineMapper" class="org.springframework.batch.item.file.mapping.DefaultLineMapper">
        <property name="fieldSetMapper" ref="observationDataMapper" />
        <property name="lineTokenizer" ref="litGeneExpressionLineTokenizer" />
    </bean>
    <bean name="litGeneExpressionLineTokenizer" class="org.springframework.batch.item.file.transform.DelimitedLineTokenizer" >
        <property name="delimiter" value="&#9;"/>
        <property name="names" value="dummy,submission_name,submission_date,template_name,tissue_type,response_agent,response_behavior_type,response_behavior,subgroup,time_point,time_point_units,target_pathogen,vaccine_year,exposure_material,Group1,Group0,comparison,baseline_time,number_subjects,cohort,adjuvant,route,scheduling,publication_reference,publication_year,publication_reference_url"/>
    </bean>

    <!-- shared helper beans -->
    <bean name="observationTemplateMap" class="java.util.HashMap">
        <constructor-arg index="0" type="java.util.Map">
            <map key-type="java.lang.String" value-type="java.lang.String">

                <entry key="hipc_iof_vaccine_ges:tissue_type" value="subject:findCellSubsetByName" />
                <entry key="hipc_iof_vaccine_ges:response_agent" value="subject:findGenesBySymbol" />
                <entry key="hipc_iof_vaccine_ges:response_behavior_type" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:response_behavior" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:subgroup" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:time_point" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:time_point_units" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:target_pathogen" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:vaccine_year" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:exposure_material" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:Group1" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:Group0" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:comparison" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:baseline_time" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:number_subjects" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:cohort" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:adjuvant" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:route" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:scheduling" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:publication_reference" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:publication_year" value="evidence:readString:createObservedLabelEvidence" />
                <entry key="hipc_iof_vaccine_ges:publication_reference_url" value="evidence:readString:createObservedUrlEvidence" />

            </map>
        </constructor-arg>
    </bean>
</beans>
